<%if (messages.success) { %>
    <script>toastAlert("Success", "<%= messages.success %>", "alert-success");</script>
<% } %>
<%if (messages.error) { %>
    <script>toastAlert("Error", "<%= messages.error %>", "alert-danger");</script>
<% } %>
<%if (messages.warning) { %>
    <script>toastAlert("Warning", "<%= messages.warning %>", "alert-secondary");</script>
<% } %>
<%if (messages.infos) { %>
    <script>toastAlert("Information", "<%= messages.infos %>", "alert-primary");</script>
<% } %>

<!-- slider -->
<Section class="img-slider" style="width:100%">
    <div class="slider-container">

        <div class="slide">
            <img src="img1.jpg">
        </div>

        <div class="slide">
            <img
                src="https://thumbs.dreamstime.com/b/anti-bribery-corruption-concepts-businessman-refusing-rejecting-money-to-take-bribe-partner-anti-bribery-150081139.jpg">
        </div>

        <div class="slide">
            <img src="https://thebetterindia-english.s3.ap-south-1.amazonaws.com/uploads/2018/10/IAC-34567890.jpg">
        </div>

    </div>
</Section>

 <!-- Modal for bidding  -->
<div class="modal" id="modal-4" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <a href="#" class="btn close" role="button" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </a>
            <h5 class="modal-title">Make New Bid</h5>

                <input type="hidden" id="contract_id" name="contract_id">
                <div class="form-group">
                    <label for="bidAmount" class="required">Bid amount</label>
                    <input type="number" id="bidAmount" name="bidAmount" class="form-control"
                        placeholder="Bid Amount" required="required">
                </div>
                
                <input onClick="makeBid()" class="btn btn-secondary btn-block" type="submit" value="Submit Bid" data-dismiss="modal">

        </div>
    </div>
</div>

 <!-- Modal for getting scheme detalis  -->
<div class="modal modal-full ie-scroll-fix" id="modal-5" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <a href="#" class="close" role="button" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </a>
        <div class="container">
          <div class="row">
            <div class="col-md-8 offset-md-2" id="scheme">
                <h2 id="scheme_title" class="mt-10 mb-10 font-weight-medium"></h2>
                <div class="d-flex flex-row">
                    <h5 class="mt-6">Publish On : - </h5>
                    <span id="scheme_date" class="font-size-16 font-weight-medium mt-10 ml-10"></span>
                </div>
                <div >
                    <img src="dummy.png" alt="" srcset="">
                </div>
                <div class="font-size-20 d-flex flex-row">
                    <h4>Estimate Cost : </h4>
                    <h4 id="scheme_cost"></h4>
                </div>
                    <p id="scheme_desc" class="font-size-20"></p>
                <button onClick="openModal()" class="btn btn-success" >Make a Bid</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Content wrapper start -->
<div>
    <div class="container-fluid">
        <div class="row row-eq-spacing-lg">
            <h3>  Latest Schemes and Projects </h3>
            <div class="col-lg-9">
                <% if ( typeof allSchemes != 'object' ) { %>
                    <div class="card">
                        <h2 class="card-title">
                            Card title
                        </h2>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
    
                        <button class="btn btn-primary btn-sm" type="button" onclick="toastAlert()">Toast!</button>
    
                    </div>
                    <div class="card">
                        <h2 class="card-title">
                            Card title
                        </h2>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
    
                        <button class="btn btn-primary btn-sm" type="button" onclick="toastAlert()">Toast!</button>
    
                    </div>
                    <div class="card">
                        <h2 class="card-title">
                            Card title
                        </h2>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
    
                        <button class="btn btn-primary btn-sm" type="button" onclick="toastAlert()">Toast!</button>
    
                    </div>
                    <div class="card">
                        <h2 class="card-title">
                            Card title
                        </h2>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
    
                        <button class="btn btn-primary btn-sm" type="button" onclick="toastAlert()">Toast!</button>
    
                    </div>
                    <div class="card">
                        <h2 class="card-title">
                            Card title
                        </h2>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
    
                        <button class="btn btn-primary btn-sm" type="button" onclick="toastAlert()">Toast!</button>
    
                    </div>
                    <div class="card">
                        <h2 class="card-title">
                            Card title
                        </h2>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
    
                        <button class="btn btn-primary btn-sm" type="button" onclick="toastAlert()">Toast!</button>
    
                    </div>
                    <div class="card">
                        <h2 class="card-title">
                            Card title
                        </h2>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
                        <div class="fake-content"></div>
    
                        <button class="btn btn-primary btn-sm" type="button" onclick="toastAlert()">Toast!</button>
    
                    </div>
    
                    <div class="content">
                        <div class="fake-content"></div>
                        <div class="fake-content w-150"></div>
                    </div>

                    <% } else { %>
                
                        <!-- Page Content -->
        
                        <%  allSchemes.forEach(function(scheme) { %>
                            <% if(scheme.id != 0) { %>
                                <div class="card">
                                    <h2 class="card-title text-capitalize font-weight-bold">
                                        <%= scheme.name %>
                                    </h2>
                                    <div class="fake-content">
                                        <span><h7 class="font-weight-semi-bold">Date of Published : </h7><%= scheme.date %></span> 
                                    </div>
                                    <div class="fake-content">
                                        <h6>Deatils : <span><%= scheme.description %> TODO</span></h6>
                                    </div>
                                    <div class="fake-content">
                                        <h6>Cost :<span> <%= scheme.cost %> </span></h6>
                                    </div>
                                    <div class="fake-content">
                                        <h6>Status : <span class="badge badge-success">Active</span> </h6> 
                                    </div>
                
                                    <a href="#modal-5" class="btn btn-primary" role="button" id="<%= scheme.id %>" onclick="getAscheme('<%= scheme.id %>')">View Details</a>
                                    
                                </div>
                                <% }  %>
                <% }) } %>

                <!-- Column end here -->
            </div> 

                

            <!-- Notification Window -->
            <div class="col-lg-3 right-0" style="margin-top:0px;">
                <div class="card content notification_window" style="overflow: hidden">
                    <h2 class="content-title font-size-20">
                        Notifications
                    </h2>
                    <div class="marquee" data-duplicated='true' data-direction='up'
                        style="width:220px;overflow-wrap: break-word;">
                        <!-- direction="up" behavior="sliding"  scrollamount="5" onmouseover="this.stop();" onmouseout="this.start();" -->
                        <a href="#">Notification 1 zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz</a><br>
                        <a href="#">Notification 1</a><br>
                        <a href="#">Notification 1</a><br>
                        <a href="#">Notification 1</a><br>
                        <a href="#">Notification 1</a><br>
                        <a href="#">Notification 1</a><br>
                        <a href="#">Notification 1</a><br>
                        <a href="#">Notification 1</a><br>
                        <a href="#">Notification 1</a><br>
                        <a href="#">Notification 1</a><br>
                    </div>
                </div>
                <div class="alert filled-lm" id="qt" role="alert">
                    <button class="close" data-dismiss="alert" type="button" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="alert-heading">Quote of the Day</h4>
                    <b id="qot"></b>
                </div>
            </div>
            <!-- Row ends here -->

        </div>
    </div>
</div>
<!-- Content wrapper end -->

<!-- Static bottom navbar -->
<nav class="navbar navbar-static-bottom">
    <ul class="navbar-nav ml-auto">
        <!-- ml-auto = margin-left: auto -->
        <li class="nav-item">
            <a href="about" class="nav-link">About us</a>
        </li>
        <li class="nav-item">
            <a href="contact" class="nav-link">Contact us</a>
        </li>
    </ul>
    <!-- Navbar text -->
    <span class="navbar-text">
        CRS-BT &copy;
        <script>let y = new Date(); document.write(y.getFullYear())</script> Made with <i
            class="fa fa-heart ml-5 mr-5"></i> By Amdar
        Boys
        <ul class="navbar-nav ml-auto">
            <li class="nav-item ">
                <a href="#top" class="btn btn-square btn-primary rounded-circle" data-toggle="tooltip"
                    data-title="Scroll to Top" data-placement="top"
                    style="margin-left: 20px;margin-top: 10px;margin-right: 30px;" role="button">
                    <i class="fa fa-sort-asc"></i>
                </a>
            </li>
        </ul>
    </span>
</nav>

<script>
    classes = Array("alert", "alert-primary", "alert-success", "alert-secondary", "alert-danger")
    qts = Array("Power doesn’t corrupt people, people corrupt power.",
        "The more corrupt the state, the more laws.",
        "Your ignorance on corruption is their power.",
        "Power tends to corrupt, and absolute power corrupts absolutely.",
        "One does not fight corruption by fighting corruption.",
        "Fighting corruption is not just good governance. It's self-defense. It's patriotism.");

    const cls = classes[Math.floor(Math.random() * classes.length)];
    const qt = qts[Math.floor(Math.random() * qts.length)]
    $("#qt").addClass(cls)
    $("#qot").text(qt);
    $("document").ready(function () {
        $("#ftr").hide()
    })

    function getAscheme(id) {
        console.log(id);
        $.get(`/getAScheme/${id}`, function(data, status) {
            console.log(data);
            $('#scheme_title').html(data[1])
            $('#scheme_desc').html(data[2])
            $('#scheme_date').html(data[3])
            $('#scheme_cost').html(data[5])

            $("#contract_id").val(data[0])
        })
    }

    function openModal() {
        $('#modal-5').hide()
        halfmoon.toggleModal('modal-4');
    }

    function makeBid() {
        const contract_id = $("#contract_id").val();
        const bidAmount = $("#bidAmount").val();

        $.ajax({
            type: "POST",
            url: "/makeBid",
            data : { contract_id, bidAmount },
            success: function (response) {
                // $('#modal-4').hide();
                toastAlert("Success", response, "alert-success");
            },
            error: function(xhr) {
                toastAlert("Error", xhr.responseText, "alert-danger");
                // $('#modal-4').hide();
            }
        }) 
    }
    
</script>